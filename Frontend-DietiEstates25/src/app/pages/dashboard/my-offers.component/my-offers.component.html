<div class="offers-page">
  <div class="page-header">
    <div class="header-left">
      <h1>Le Mie Offerte</h1>
      <p class="subtitle">Gestisci le tue offerte per gli immobili</p>
    </div>
    <div class="header-actions">
      <button class="btn-primary" (click)="goToSearch()">
        <span class="material-icons">home</span>
        Cerca Immobili
      </button>
    </div>
  </div>

  <div class="tabs">
    <button 
      class="tab" 
      [class.active]="activeTab === 'active'"
      (click)="activeTab = 'active'"
    >
      Attive ({{ activeOffers.length }})
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'closed'"
      (click)="activeTab = 'closed'"
    >
      Chiuse ({{ closedOffers.length }})
    </button>
  </div>

  <div class="offers-list" *ngIf="!loading">
    <div *ngFor="let offer of displayedOffers" class="offer-card">
      <div class="offer-property">
        <div class="property-image">
          <span class="material-icons">home</span>
        </div>
        <div class="property-info">
          <h3>{{ offer.propertyTitle }}</h3>
          <span class="status-badge" [ngClass]="getStatusClass(offer.status)">
            <span class="material-icons" *ngIf="offer.status === 'COUNTEROFFER'">swap_vert</span>
            {{ getStatusLabel(offer.status) }}
          </span>
        </div>
      </div>

      <div class="offer-details">
        <div class="offer-amount">
          <span class="label">€</span>
          <span class="amount">La tua offerta: <strong>{{ formatCurrency(offer.amount) }}</strong></span>
        </div>

        <div *ngIf="offer.status === 'COUNTEROFFER' && offer.counterOfferAmount" class="counter-offer-banner">
          <span class="material-icons">swap_vert</span>
          <span>Controproposta dell'agente: {{ formatCurrency(offer.counterOfferAmount) }}</span>
        </div>

        <div *ngIf="offer.message" class="offer-note">
          <span class="note-label">Note:</span> {{ offer.message }}
        </div>

        <div class="offer-date">
          Inviata il {{ formatDate(offer.createdAt) }}
        </div>
      </div>

      <div class="offer-actions" *ngIf="offer.status === 'COUNTEROFFER'">
        <button class="btn-accept" (click)="acceptCounterOffer(offer)">
          <span class="material-icons">check_circle</span>
          Accetta Controproposta
        </button>
        <button class="btn-counter" (click)="openCounterModal(offer)">
          <span class="material-icons">swap_vert</span>
          Rilancia
        </button>
        <button class="btn-withdraw" (click)="withdrawOffer(offer)">
          <span class="material-icons">close</span>
          Ritira Offerta
        </button>
      </div>

      <div class="offer-actions" *ngIf="offer.status === 'SUBMITTED'">
        <button class="btn-withdraw" (click)="withdrawOffer(offer)">
          <span class="material-icons">close</span>
          Ritira Offerta
        </button>
      </div>
    </div>

    <div *ngIf="displayedOffers.length === 0" class="empty-state">
      <span class="material-icons">local_offer</span>
      <h3>Nessuna offerta {{ activeTab === 'active' ? 'attiva' : 'chiusa' }}</h3>
      <p>{{ activeTab === 'active' ? 'Non hai offerte attive al momento.' : 'Non hai offerte chiuse.' }}</p>
      <button *ngIf="activeTab === 'active'" class="btn-primary" (click)="goToSearch()">
        Cerca Immobili
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Caricamento offerte...</p>
  </div>
</div>

<!-- Counter Offer Modal -->
<div class="modal-overlay" *ngIf="showCounterModal" (click)="closeCounterModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="closeCounterModal()">
      <span class="material-icons">close</span>
    </button>
    
    <h2>Invia nuova offerta</h2>
    <p class="modal-subtitle">Inserisci l'importo della tua nuova offerta</p>

    <div class="form-group">
      <label>Importo (€)</label>
      <input 
        type="number" 
        [(ngModel)]="counterAmount" 
        placeholder="es. 350000"
        class="form-input"
      >
    </div>

    <p class="current-counter" *ngIf="selectedOffer?.counterOfferAmount">
      Controproposta attuale: {{ formatCurrency(selectedOffer!.counterOfferAmount!) }}
    </p>

    <div class="modal-actions">
      <button class="btn-secondary" (click)="closeCounterModal()">Annulla</button>
      <button class="btn-primary" (click)="submitCounter()" [disabled]="!counterAmount">
        Invia Offerta
      </button>
    </div>
  </div>
</div>
