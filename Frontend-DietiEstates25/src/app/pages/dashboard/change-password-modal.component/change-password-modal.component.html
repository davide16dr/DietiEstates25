<div class="modal-overlay" (click)="onClose()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Cambia Password</h2>
      <button class="close-btn" (click)="onClose()">×</button>
    </div>

    <div class="modal-body">
      <form class="password-form" (ngSubmit)="onSave()">
        <!-- Password Attuale -->
        <div class="form-group">
          <label for="oldPassword">Password Attuale *</label>
          <div class="password-input-wrapper">
            <input
              [type]="showOldPassword() ? 'text' : 'password'"
              id="oldPassword"
              [value]="oldPassword()"
              (input)="updateOldPassword($event)"
              placeholder="Inserisci la password attuale"
              required
            />
            <button type="button" class="toggle-password" (click)="toggleOldPassword()">
              <img [src]="showOldPassword() ? 'assets/icons/visibility.png' : 'assets/icons/visibility_off.png'" alt="Toggle visibility" />
            </button>
          </div>
        </div>

        <!-- Nuova Password -->
        <div class="form-group">
          <label for="newPassword">Nuova Password *</label>
          <div class="password-input-wrapper">
            <input
              [type]="showNewPassword() ? 'text' : 'password'"
              id="newPassword"
              [value]="newPassword()"
              (input)="updateNewPassword($event)"
              placeholder="Inserisci la nuova password"
              required
            />
            <button type="button" class="toggle-password" (click)="toggleNewPassword()">
              <img [src]="showNewPassword() ? 'assets/icons/visibility.png' : 'assets/icons/visibility_off.png'" alt="Toggle visibility" />
            </button>
          </div>
          @if (newPassword()) {
            <div class="password-strength">
              <span class="strength-label">Sicurezza:</span>
              <span class="strength-indicator" [class]="passwordStrength">
                {{ passwordStrength === 'debole' ? 'Debole' : passwordStrength === 'media' ? 'Media' : 'Forte' }}
              </span>
            </div>
          }
          <p class="hint">Minimo 8 caratteri</p>
        </div>

        <!-- Conferma Password -->
        <div class="form-group">
          <label for="confirmPassword">Conferma Nuova Password *</label>
          <div class="password-input-wrapper">
            <input
              [type]="showConfirmPassword() ? 'text' : 'password'"
              id="confirmPassword"
              [value]="confirmPassword()"
              (input)="updateConfirmPassword($event)"
              placeholder="Ripeti la nuova password"
              required
            />
            <button type="button" class="toggle-password" (click)="toggleConfirmPassword()">
              <img [src]="showConfirmPassword() ? 'assets/icons/visibility.png' : 'assets/icons/visibility_off.png'" alt="Toggle visibility" />
            </button>
          </div>
          @if (confirmPassword() && newPassword() !== confirmPassword()) {
            <p class="error-hint">Le password non coincidono</p>
          }
          @if (confirmPassword() && newPassword() === confirmPassword()) {
            <p class="success-hint">✓ Le password coincidono</p>
          }
        </div>

        <!-- Error Message -->
        @if (errorMessage()) {
          <div class="error-message">
            {{ errorMessage() }}
          </div>
        }
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" type="button" (click)="onClose()">Annulla</button>
      <button 
        class="btn-primary" 
        type="submit" 
        (click)="onSave()"
        [disabled]="!isFormValid()"
      >
        Cambia Password
      </button>
    </div>
  </div>
</div>
